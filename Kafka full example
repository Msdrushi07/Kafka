Perfect ğŸ™Œ Letâ€™s build a ready-to-use Spring Boot Kafka project structure that covers:

âœ… Producer (publishes messages)

âœ… Consumer (processes messages)

âœ… Error Handling (retry + DLQ)

âœ… DLQ Consumer (logs failed messages)

âœ… DLQ Reprocessor (re-sends messages back to main topic)



---

ğŸ“‚ Project Structure (Maven)

spring-kafka-demo/
 â”œâ”€â”€ src/main/java/com/example/kafka/
 â”‚    â”œâ”€â”€ config/
 â”‚    â”‚     â””â”€â”€ KafkaErrorHandlerConfig.java
 â”‚    â”œâ”€â”€ consumer/
 â”‚    â”‚     â”œâ”€â”€ OrderConsumer.java
 â”‚    â”‚     â””â”€â”€ DlqConsumer.java
 â”‚    â”œâ”€â”€ producer/
 â”‚    â”‚     â””â”€â”€ OrderProducer.java
 â”‚    â”œâ”€â”€ reprocessor/
 â”‚    â”‚     â””â”€â”€ DlqReprocessor.java
 â”‚    â””â”€â”€ SpringKafkaDemoApplication.java
 â””â”€â”€ src/main/resources/
      â””â”€â”€ application.yml


---

âš™ï¸ application.yml

spring:
  kafka:
    bootstrap-servers: localhost:9092
    consumer:
      group-id: order-group
      auto-offset-reset: earliest
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.ErrorHandlingDeserializer
      properties:
        spring.deserializer.value.delegate.class: org.springframework.kafka.support.serializer.JsonDeserializer
        spring.json.trusted.packages: "*"
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer


---

ğŸ› ï¸ KafkaErrorHandlerConfig.java

package com.example.kafka.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.kafka.core.KafkaTemplate;
import org.springframework.kafka.listener.DefaultErrorHandler;
import org.springframework.kafka.listener.DeadLetterPublishingRecoverer;
import org.springframework.util.backoff.FixedBackOff;

@Configuration
public class KafkaErrorHandlerConfig {

    @Bean
    public DefaultErrorHandler errorHandler(KafkaTemplate<Object, Object> template) {
        DeadLetterPublishingRecoverer recoverer =
                new DeadLetterPublishingRecoverer(template); // sends to <topic>.DLT

        // Retry 3 times, 2s apart, then send to DLQ
        FixedBackOff fixedBackOff = new FixedBackOff(2000L, 3);

        return new DefaultErrorHandler(recoverer, fixedBackOff);
    }
}


---


import org.apache.kafka.clients.admin.NewTopic;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class KafkaTopicConfig {

    @Bean
    public NewTopic ordersTopic() {
        return new NewTopic("orders", 3, (short) 1); 
        // 3 partitions, replication factor 1
    }

    @Bean
    public NewTopic ordersDltTopic() {
        return new NewTopic("orders.DLT", 3, (short) 1);
    }
}


---
ğŸ“¨ OrderProducer.java

package com.example.kafka.producer;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.kafka.core.KafkaTemplate;
import org.springframework.stereotype.Service;

@Service
public class OrderProducer {

    @Autowired
    private KafkaTemplate<String, String> kafkaTemplate;

    public void sendOrder(String order) {
        kafkaTemplate.send("orders", order);
        System.out.println("âœ… Sent order: " + order);
    }
}


---

ğŸ“¥ OrderConsumer.java

package com.example.kafka.consumer;

import org.springframework.kafka.annotation.KafkaListener;
import org.springframework.kafka.support.Acknowledgment;
import org.springframework.stereotype.Service;

@Service
public class OrderConsumer {

    @KafkaListener(topics = "orders", groupId = "order-group")
    public void consume(String message, Acknowledgment ack) {
        try {
            System.out.println("Processing order: " + message);

            if (message.contains("fail")) {
                throw new RuntimeException("Simulated failure: " + message);
            }

            ack.acknowledge(); // commit offset only if success
        } catch (Exception e) {
            // âŒ donâ€™t ack â†’ triggers errorHandler (retries + DLQ)
            throw e;
        }
    }
}


---

âŒ DlqConsumer.java (Monitor DLQ)

package com.example.kafka.consumer;

import org.springframework.kafka.annotation.KafkaListener;
import org.springframework.stereotype.Service;

@Service
public class DlqConsumer {

    @KafkaListener(topics = "orders.DLT", groupId = "dlq-group")
    public void consumeDlq(String message) {
        System.out.println("ğŸš¨ Message moved to DLQ: " + message);
    }
}


---

â™»ï¸ DlqReprocessor.java (Re-send from DLQ â†’ Main)

package com.example.kafka.reprocessor;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.kafka.annotation.KafkaListener;
import org.springframework.kafka.core.KafkaTemplate;
import org.springframework.stereotype.Service;

@Service
public class DlqReprocessor {

    @Autowired
    private KafkaTemplate<String, String> kafkaTemplate;

    @KafkaListener(topics = "orders.DLT", groupId = "dlq-reprocessor")
    public void reprocess(String message) {
        System.out.println("â™»ï¸ Reprocessing DLQ message: " + message);

        try {
            if (message.contains("bad")) {
                System.out.println("âš ï¸ Skipping permanently bad message: " + message);
                return;
            }

            kafkaTemplate.send("orders", message);
            System.out.println("âœ… Resent message to orders: " + message);

        } catch (Exception e) {
            System.err.println("âŒ Reprocessing failed: " + e.getMessage());
        }
    }
}


---

ğŸš€ SpringKafkaDemoApplication.java

package com.example.kafka;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class SpringKafkaDemoApplication {
    public static void main(String[] args) {
        SpringApplication.run(SpringKafkaDemoApplication.class, args);
    }
}


---

ğŸ”„ How It Works

1. Normal flow â†’
Producer â†’ orders topic â†’ Consumer processes â†’ Ack on success.


2. Failure flow â†’
Consumer fails â†’ retried 3 times â†’ message goes to orders.DLT.


3. DLQ monitoring â†’
DlqConsumer logs failed messages.


4. Reprocessing â†’
DlqReprocessor listens to DLQ â†’ re-sends valid messages to orders.




---

using command creating topics
# Create main topic
kafka-topics.sh --create --topic orders --partitions 3 --replication-factor 1 --bootstrap-server localhost:9092

# Create DLQ topic
kafka-topics.sh --create --topic orders.DLT --partitions 3 --replication-factor 1 --bootstrap-server localhost:9092



